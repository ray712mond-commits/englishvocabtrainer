<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€å…±äº«ç‰ˆã€‘æˆ‘çš„è‹±æ–‡å–®å­—ç·´ç¿’æœ¬ - ä½¿ç”¨ Firebase</title>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebase/9/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebase/9/firebase-firestore.js";

        // =========================================================
        // !!! ğŸš¨ é€™è£¡éœ€è¦è²¼ä¸Šæ‚¨å¾ Firebase å°ˆæ¡ˆè¤‡è£½çš„è¨­å®šè³‡è¨Š !!!
        // =========================================================
        const firebaseConfig = {
            apiKey: "AIzaSyDbmwpXx0mnZDd5xOcc2qlc3BkrE7_VFVw",
            authDomain: "englishvocabtrainer-b1de4",
            projectId: "englishvocabtrainer-b1de4.firebasestorage.app",
            storageBucket: "415372743931",
            messagingSenderId: "1:415372743931:web:3a734463227111d5704c5e",
            appId: "G-C58L8RZ17H"
        };
        // =========================================================

        // åˆå§‹åŒ– Firebase App å’Œ Firestore
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const vocabCollection = collection(db, "vocabWords"); // è³‡æ–™åº«ä¸­å–®å­—çš„é›†åˆåç¨±

        // å°‡æ‰€æœ‰ JavaScript å‡½æ•¸æ”¾å…¥ä¸€å€‹å…¨åŸŸç‰©ä»¶ï¼Œä»¥ä¾¿åœ¨ä¸»è…³æœ¬ä¸­å­˜å–
        window.firebaseUtils = {
            db, vocabCollection, onSnapshot, doc, deleteDoc, addDoc, serverTimestamp
        };
    </script>

    <style>
        /* CSS æ¨£å¼èˆ‡å‰ä¸€å€‹ç‰ˆæœ¬ç›¸åŒï¼Œä¿æŒç°¡æ½” */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background-color: #f4f7f6; color: #333; }
        .container { max-width: 900px; margin: auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        h1 { color: #007bff; text-align: center; margin-bottom: 30px; }
        .tab-menu { display: flex; margin-bottom: 20px; border-bottom: 2px solid #ddd; }
        .tab-button { padding: 12px 20px; cursor: pointer; border: none; background-color: #eee; margin-right: 5px; border-radius: 8px 8px 0 0; font-weight: bold; transition: background-color 0.3s; }
        .tab-button.active { background-color: #007bff; color: white; border-bottom: 2px solid #007bff; }
        .tab-content { display: none; padding-top: 20px; }
        .tab-content.active { display: block; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; transition: border-color 0.3s; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { border-color: #007bff; outline: none; }
        button { background-color: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; transition: background-color 0.3s; }
        button:hover { background-color: #218838; }
        #quizArea { border: 1px dashed #007bff; padding: 20px; border-radius: 8px; margin-top: 20px; }
        #quizQuestion { font-size: 24px; font-weight: bold; margin-bottom: 15px; min-height: 30px; }
        #hintArea { margin-top: 10px; color: #555; min-height: 20px; }
        .feedback { margin-top: 15px; padding: 10px; border-radius: 6px; display: none; }
        .feedback.correct { background-color: #d4edda; color: #155724; }
        .feedback.incorrect { background-color: #f8d7da; color: #721c24; }
        .answer-reveal { margin-top: 10px; font-weight: bold; color: #007bff; }
        #correctAnswer, #quizScore { margin-top: 10px; font-size: 18px; }
        #vocabTable th { border: 1px solid #ddd; padding: 8px; background-color: #f2f2f2; text-align: left; }
        #vocabTable td { border: 1px solid #ddd; padding: 8px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ã€å…±äº«ç‰ˆã€‘æˆ‘çš„è‹±æ–‡å–®å­—ç·´ç¿’æœ¬</h1>
    <p style="text-align: center; color: red; font-weight: bold;">ğŸš¨ æ³¨æ„ï¼šå–®å­—è³‡æ–™å·²åŒæ­¥è‡³å…±äº«é›²ç«¯è³‡æ–™åº«ï¼</p>

    <div class="tab-menu">
        <button class="tab-button active" onclick="openTab(event, 'uploadTab')">ä¸Šå‚³æ–°å–®å­—</button>
        <button class="tab-button" onclick="openTab(event, 'quizSetupTab')">é–‹å§‹æŠ½è€ƒ</button>
        <button class="tab-button" onclick="openTab(event, 'listTab')">å–®å­—æ¸…å–® (å…±äº«)</button>
    </div>

    <div id="uploadTab" class="tab-content active">
        <h2>ä¸Šå‚³æ–°å–®å­—</h2>
        <form id="uploadForm">
            <div class="form-group">
                <label for="word">å–®å­— (è‹±æ–‡):</label>
                <input type="text" id="word" required>
            </div>
            <div class="form-group">
                <label for="meaning">ä¸­æ–‡æ„æ€:</label>
                <input type="text" id="meaning" required>
            </div>
            <div class="form-group">
                <label for="partOfSpeech">è©æ€§:</label>
                <select id="partOfSpeech" required>
                    <option value="">--è«‹é¸æ“‡--</option>
                    <option value="n">åè© (n.)</option>
                    <option value="v">å‹•è© (v.)</option>
                    <option value="adj">å½¢å®¹è© (adj.)</option>
                    <option value="adv">å‰¯è© (adv.)</option>
                    <option value="prep">ä»‹ç³»è© (prep.)</option>
                    <option value="conj">é€£æ¥è© (conj.)</option>
                    <option value="phr">ç‰‡èª (phr.)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="context">çœ‹åˆ°å–®å­—çš„åœ°æ–¹/æƒ…æ³ (ä½œç‚ºæç¤ºç”¨):</label>
                <textarea id="context" required></textarea>
            </div>
            <button type="submit">å„²å­˜å–®å­—</button>
            <p id="uploadMessage" style="color: green; margin-top: 10px; display: none;"></p>
        </form>
    </div>

    <div id="quizSetupTab" class="tab-content">
        <h2>æŠ½è€ƒè¨­å®š</h2>
        <div class="form-group">
            <label for="quizCount">æŠ½è€ƒé¡Œæ•¸:</label>
            <input type="number" id="quizCount" value="10" min="1" max="50">
        </div>
        <div class="form-group">
            <label for="quizRange">æŠ½è€ƒç¯„åœ (å¯é¸ï¼Œç•™ç©ºç‚ºå…¨éƒ¨å–®å­—):</label>
            <input type="text" id="quizRange" placeholder="è¼¸å…¥éƒ¨åˆ†ä¸­æ–‡æ„æ€æˆ–è‹±æ–‡å–®å­—ï¼Œä»¥é€—è™Ÿåˆ†éš”">
        </div>
        <div class="form-group">
            <label for="hintLimit">æç¤ºæ¬¡æ•¸ä¸Šé™ (1~5):</label>
            <input type="number" id="hintLimit" value="3" min="1" max="5">
        </div>
        <button onclick="startQuiz()">é–‹å§‹æ¸¬é©—</button>

        <div id="quizArea" style="display: none;">
            <h3>å–®å­—æ¸¬é©—</h3>
            <p id="quizScore">ç¬¬ 1 é¡Œ / å…± 10 é¡Œ</p>
            <p id="quizType"></p>
            <div id="quizQuestion"></div>
            <div class="form-group">
                <label for="studentAnswer">æ‚¨çš„ç­”æ¡ˆ:</label>
                <input type="text" id="studentAnswer">
            </div>
            <button onclick="submitAnswer()">é€å‡ºç­”æ¡ˆ</button>
            <button onclick="showHint()" id="hintButton">æç¤º (å‰©é¤˜ <span id="hintRemaining">3</span> æ¬¡)</button>

            <div id="hintArea"></div>
            
            <div class="feedback" id="quizFeedback"></div>
            <div id="correctAnswer" style="display: none;">æ­£ç¢ºç­”æ¡ˆ: <span id="theAnswer"></span></div>
            <button onclick="nextQuestion()" id="nextButton" style="display: none; background-color: #007bff;">ä¸‹ä¸€é¡Œ</button>
        </div>
        <div id="quizResult" style="margin-top: 20px; font-size: 20px; font-weight: bold; display: none;"></div>
    </div>

    <div id="listTab" class="tab-content">
        <h2>å·²ä¸Šå‚³å–®å­—æ¸…å–® (å…±äº«)</h2>
        <p>ç›®å‰ç¸½è¨ˆï¼š<span id="vocabCount">0</span> å€‹å–®å­—</p>
        <table id="vocabTable" style="width: 100%; border-collapse: collapse; margin-top: 15px;">
            <thead>
                <tr>
                    <th>å–®å­— (è©æ€§)</th>
                    <th>ä¸­æ–‡æ„æ€</th>
                    <th>æƒ…å¢ƒ (æç¤º)</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
    </div>

</div>

<script>
    // ** å…¨åŸŸè®Šæ•¸ **
    let vocabList = [];
    let currentQuiz = []; 
    let currentQuestionIndex = 0;
    let quizSettings = {};
    let currentHintsUsed = 0;
    let correctAnswers = 0;

    // ** è³‡æ–™å„²å­˜ (ä½¿ç”¨ Firebase Firestore) **
    
    /** å•Ÿå‹•å³æ™‚ç›£è½ï¼Œå¾ Firestore è®€å–æ‰€æœ‰å–®å­—ä¸¦æ›´æ–°å…¨åŸŸè®Šæ•¸ */
    function startRealtimeListener() {
        const { vocabCollection, onSnapshot } = window.firebaseUtils;

        onSnapshot(vocabCollection, (snapshot) => {
            vocabList = [];
            snapshot.forEach((doc) => {
                // å°‡ Firebase æ–‡ä»¶ ID ä½œç‚ºå”¯ä¸€ ID å„²å­˜ (é‡è¦!)
                vocabList.push({ id: doc.id, ...doc.data() });
            });
            // è³‡æ–™æ›´æ–°å¾Œï¼Œç«‹å³é‡æ–°æ¸²æŸ“åˆ—è¡¨
            renderVocabList(); 
        }, (error) => {
            console.error("Error listening to Firestore: ", error);
            document.getElementById('vocabCount').textContent = 'è¼‰å…¥å¤±æ•—';
            alert("ç„¡æ³•å¾è³‡æ–™åº«è¼‰å…¥å–®å­—ã€‚è«‹æª¢æŸ¥ Firebase é€£ç·šæˆ–è¨­å®šã€‚");
        });
    }

    // ** 1. ä¸Šå‚³å–®å­—åŠŸèƒ½ (å¯«å…¥ Firestore) **

    document.getElementById('uploadForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const { vocabCollection, addDoc, serverTimestamp } = window.firebaseUtils;

        const newWordData = {
            word: document.getElementById('word').value.trim(),
            meaning: document.getElementById('meaning').value.trim(),
            partOfSpeech: document.getElementById('partOfSpeech').value,
            context: document.getElementById('context').value.trim(),
            timestamp: serverTimestamp(), // è¨˜éŒ„ä¸Šå‚³æ™‚é–“
            // ğŸ’¡ æç¤ºï¼šæœªä¾†è‹¥å¯¦ä½œå­¸ç”Ÿç™»å…¥ï¼Œå¯ä»¥åœ¨é€™è£¡åŠ ä¸Š `userId: currentUser.uid`
        };

        // æª¢æŸ¥å–®å­—æ˜¯å¦å·²ç¶“å­˜åœ¨ (ç°¡åŒ–æª¢æŸ¥ï¼Œç²¾ç¢ºæª¢æŸ¥éœ€è¦æ›´è¤‡é›œçš„ Firestore æŸ¥è©¢)
        const existing = vocabList.find(v => v.word.toLowerCase() === newWordData.word.toLowerCase());
        if (existing) {
            alert(`å–®å­— "${newWordData.word}" å·²ç¶“å­˜åœ¨æ–¼æ¸…å–®ä¸­ï¼`);
            return;
        }

        try {
            await addDoc(vocabCollection, newWordData);

            // é¡¯ç¤ºæˆåŠŸè¨Šæ¯ä¸¦æ¸…ç©ºè¡¨å–®
            const msg = document.getElementById('uploadMessage');
            msg.textContent = `æˆåŠŸå„²å­˜å–®å­—: ${newWordData.word} (å·²åŒæ­¥åˆ°é›²ç«¯)`;
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 3000);
            document.getElementById('uploadForm').reset();
        } catch (error) {
            console.error("Error adding document: ", error);
            alert("å„²å­˜å¤±æ•—ï¼è«‹æª¢æŸ¥ Firebase è¨­å®šæˆ–æ¬Šé™ (Firestore Rules)ã€‚");
        }
    });

    // ** 3. å–®å­—æ¸…å–®é¡¯ç¤º/æ“ä½œ **

    /** æ¸²æŸ“å–®å­—æ¸…å–®è¡¨æ ¼ */
    function renderVocabList() {
        const tbody = document.getElementById('vocabTable').querySelector('tbody');
        tbody.innerHTML = '';
        document.getElementById('vocabCount').textContent = vocabList.length;

        // ğŸ’¡ è€å¸«å¯ä»¥å¾é€™è£¡çœ‹åˆ°æ‰€æœ‰å­¸ç”Ÿä¸Šå‚³çš„å–®å­—
        vocabList.forEach(vocab => {
            const row = tbody.insertRow();
            // æ³¨æ„ï¼šé€™è£¡ä½¿ç”¨ vocab.idï¼Œå®ƒç¾åœ¨æ˜¯ Firestore çš„æ–‡ä»¶ ID (Document ID)
            row.innerHTML = `
                <td>${vocab.word} (${vocab.partOfSpeech})</td>
                <td>${vocab.meaning}</td>
                <td>${vocab.context}</td>
                <td><button style="background-color: #dc3545;" onclick="deleteVocab('${vocab.id}')">åˆªé™¤</button></td>
            `;
        });
    }

    /** åˆªé™¤å–®å­— (å¾ Firestore åˆªé™¤) */
    async function deleteVocab(docId) {
        const { db, doc, deleteDoc } = window.firebaseUtils;
        
        if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹å–®å­—å—ï¼Ÿæ­¤æ“ä½œæœƒå¾å…±äº«è³‡æ–™åº«ä¸­æ°¸ä¹…ç§»é™¤ï¼')) {
            try {
                await deleteDoc(doc(db, "vocabWords", docId));
                // æˆåŠŸå¾Œï¼ŒonSnapshot æœƒè‡ªå‹•æ›´æ–°æ¸…å–®
            } catch (error) {
                 console.error("Error deleting document: ", error);
                 alert("åˆªé™¤å¤±æ•—ï¼è«‹æª¢æŸ¥ Firebase é€£ç·šæˆ–æ¬Šé™ã€‚");
            }
        }
    }

    // ** 2. æŠ½è€ƒåŠŸèƒ½ (é‚è¼¯èˆ‡å‰ä¸€å€‹ç‰ˆæœ¬ç›¸åŒï¼Œå› ç‚ºå®ƒä¾è³´æ–¼å·²åŒæ­¥çš„ vocabList é™£åˆ—) **

    /** åˆå§‹åŒ–æ¸¬é©—è¨­å®šä¸¦æº–å‚™é¡Œç›® */
    function startQuiz() {
        if (vocabList.length === 0) {
            alert('å–®å­—æ¸…å–®æ˜¯ç©ºçš„ï¼Œè«‹å…ˆä¸Šå‚³å–®å­—ï¼');
            return;
        }

        // è®€å–è¨­å®š
        const count = parseInt(document.getElementById('quizCount').value);
        const rangeText = document.getElementById('quizRange').value.trim();
        const hintLimit = parseInt(document.getElementById('hintLimit').value);
        
        quizSettings = {
            count: Math.min(count, vocabList.length), 
            range: rangeText ? rangeText.toLowerCase().split(',').map(s => s.trim()) : [],
            hintLimit: Math.min(Math.max(hintLimit, 1), 5) 
        };

        // ç¯©é¸ç¯„åœ
        let filteredVocab = vocabList;
        if (quizSettings.range.length > 0 && quizSettings.range[0] !== "") {
            filteredVocab = vocabList.filter(vocab => {
                return quizSettings.range.some(keyword => 
                    vocab.word.toLowerCase().includes(keyword) || 
                    vocab.meaning.includes(keyword)
                );
            });
        }

        if (filteredVocab.length === 0) {
            alert('æ‰¾ä¸åˆ°ç¬¦åˆç¯„åœçš„å–®å­—ï¼Œè«‹ä¿®æ”¹æŠ½è€ƒç¯„åœï¼');
            return;
        }

        // éš¨æ©ŸæŠ½é¸é¡Œç›®
        currentQuiz = [];
        const availableVocab = [...filteredVocab]; 
        for (let i = 0; i < quizSettings.count; i++) {
            const randomIndex = Math.floor(Math.random() * availableVocab.length);
            const selectedVocab = availableVocab.splice(randomIndex, 1)[0];
            
            // éš¨æ©Ÿæ±ºå®šè€ƒæ³•: 0=çœ‹è‹±æ–‡å¯«ä¸­æ–‡, 1=çœ‹ä¸­æ–‡å¯«è‹±æ–‡
            const type = Math.floor(Math.random() * 2);
            currentQuiz.push({
                ...selectedVocab,
                type: type,
                isCorrect: false,
                hintsUsed: 0,
                studentInput: ''
            });
            if (availableVocab.length === 0) break;
        }

        // é‡ç½®æ¸¬é©—ç‹€æ…‹
        currentQuestionIndex = 0;
        correctAnswers = 0;
        document.getElementById('quizArea').style.display = 'block';
        document.getElementById('quizResult').style.display = 'none';

        loadQuestion();
        openTab(null, 'quizSetupTab'); 
    }

    /** è¼‰å…¥ç•¶å‰é¡Œç›® */
    function loadQuestion() {
        if (currentQuestionIndex >= currentQuiz.length) {
            endQuiz();
            return;
        }

        const currentQ = currentQuiz[currentQuestionIndex];
        currentHintsUsed = currentQ.hintsUsed;

        // é‡ç½®ä»‹é¢
        document.getElementById('quizScore').textContent = `ç¬¬ ${currentQuestionIndex + 1} é¡Œ / å…± ${currentQuiz.length} é¡Œ`;
        document.getElementById('studentAnswer').value = '';
        document.getElementById('quizFeedback').style.display = 'none';
        document.getElementById('correctAnswer').style.display = 'none';
        document.getElementById('nextButton').style.display = 'none';
        document.getElementById('hintArea').textContent = '';
        document.getElementById('hintButton').style.display = 'inline-block';
        document.getElementById('hintRemaining').textContent = quizSettings.hintLimit - currentHintsUsed;
        document.getElementById('studentAnswer').disabled = false;
        document.querySelector('#quizArea button:nth-child(5)').disabled = false; 

        // è¨­ç½®å•é¡Œ
        let questionText = "";
        let quizType = "";
        if (currentQ.type === 0) { 
            quizType = "çœ‹è‹±æ–‡å¯«ä¸­æ–‡æ„æ€";
            questionText = `${currentQ.word} (${currentQ.partOfSpeech}) çš„ä¸­æ–‡æ„æ€æ˜¯ï¼Ÿ`;
        } else { 
            quizType = "çœ‹ä¸­æ–‡æ„æ€å¯«è‹±æ–‡å–®å­—";
            questionText = `ã€Œ${currentQ.meaning}ã€çš„è‹±æ–‡å–®å­—æ˜¯ï¼Ÿ`;
        }
        document.getElementById('quizType').textContent = `[é¡Œå‹] ${quizType}`;
        document.getElementById('quizQuestion').textContent = questionText;

        // éš±è—/é¡¯ç¤ºæç¤ºæŒ‰éˆ•
        if (currentHintsUsed >= quizSettings.hintLimit) {
            document.getElementById('hintButton').style.display = 'none';
        }
    }

    /** é¡¯ç¤ºæç¤º */
    function showHint() {
        if (currentHintsUsed < quizSettings.hintLimit) {
            currentHintsUsed++;
            currentQuiz[currentQuestionIndex].hintsUsed = currentHintsUsed; 
            
            document.getElementById('hintArea').textContent = `æƒ…å¢ƒæç¤ºï¼š${currentQuiz[currentQuestionIndex].context}`;
            document.getElementById('hintRemaining').textContent = quizSettings.hintLimit - currentHintsUsed;
        }

        if (currentHintsUsed >= quizSettings.hintLimit) {
            document.getElementById('hintButton').style.display = 'none';
        }
    }

    /** é€å‡ºç­”æ¡ˆä¸¦æ‰¹æ”¹ */
    function submitAnswer() {
        const studentAnswer = document.getElementById('studentAnswer').value.trim();
        const currentQ = currentQuiz[currentQuestionIndex];
        
        // æ‰¹æ”¹é‚è¼¯
        let isCorrect = false;
        let correctAnswerText = '';

        if (currentQ.type === 0) { 
            correctAnswerText = currentQ.meaning;
            isCorrect = correctAnswerText.toLowerCase().includes(studentAnswer.toLowerCase());
        } else { 
            correctAnswerText = currentQ.word;
            isCorrect = studentAnswer.toLowerCase() === correctAnswerText.toLowerCase();
        }

        // é¡¯ç¤ºçµæœ
        const feedback = document.getElementById('quizFeedback');
        const correctDisplay = document.getElementById('theAnswer');
        
        feedback.style.display = 'block';
        document.getElementById('correctAnswer').style.display = 'block';
        document.getElementById('nextButton').style.display = 'inline-block';
        document.getElementById('hintButton').style.display = 'none';
        document.getElementById('studentAnswer').disabled = true;
        document.querySelector('#quizArea button:nth-child(5)').disabled = true; 
        
        correctDisplay.textContent = correctAnswerText;

        if (isCorrect && !currentQ.isCorrect) { 
            feedback.className = 'feedback correct';
            feedback.textContent = 'âœ… æ­£ç¢ºï¼ç­”å°äº†ï¼';
            correctAnswers++;
            currentQ.isCorrect = true; 
        } else if (isCorrect && currentQ.isCorrect) {
             feedback.className = 'feedback correct';
            feedback.textContent = 'âœ… æ­£ç¢ºï¼';
        } else {
            feedback.className = 'feedback incorrect';
            feedback.textContent = 'âŒ éŒ¯èª¤ï¼è«‹çœ‹æ­£ç¢ºç­”æ¡ˆï¼Œæˆ–é»é¸ä¸‹ä¸€é¡Œã€‚';
        }

        // å„²å­˜å­¸ç”Ÿçš„ä½œç­”ç´€éŒ„
        currentQ.studentInput = studentAnswer;
    }

    /** é€²å…¥ä¸‹ä¸€é¡Œ */
    function nextQuestion() {
        currentQuestionIndex++;
        loadQuestion();
    }

    /** çµæŸæ¸¬é©— */
    function endQuiz() {
        document.getElementById('quizArea').style.display = 'none';
        const resultDisplay = document.getElementById('quizResult');
        resultDisplay.style.display = 'block';
        resultDisplay.innerHTML = `
            æ¸¬é©—çµæŸï¼<br>
            ç¸½å…± ${currentQuiz.length} é¡Œï¼Œç­”å° ${correctAnswers} é¡Œã€‚<br>
            æ­£ç¢ºç‡ï¼š${((correctAnswers / currentQuiz.length) * 100).toFixed(1)}%
            <hr>
            <h4>æ¸¬é©—çµæœè©³æƒ…ï¼š</h4>
        `;
        
        currentQuiz.forEach((q, index) => {
            const correctAnswer = q.type === 0 ? q.meaning : q.word;
            const questionPrompt = q.type === 0 ? q.word : q.meaning;
            const status = q.isCorrect ? 'âœ… ç­”å°' : 'âŒ ç­”éŒ¯';
            const statusColor = q.isCorrect ? 'green' : 'red';
            resultDisplay.innerHTML += `
                <p style="border-left: 4px solid ${statusColor}; padding-left: 10px;">
                    <strong>${index + 1}. ${questionPrompt}</strong> <span style="color: ${statusColor};">(${status})</span><br>
                    æ‚¨çš„ç­”æ¡ˆ: ${q.studentInput || 'æœªä½œç­”'} <br>
                    æ­£ç¢ºç­”æ¡ˆ: ${correctAnswer} (${q.partOfSpeech})<br>
                    æç¤ºä½¿ç”¨: ${q.hintsUsed} æ¬¡
                </p>
            `;
        });
    }

    // ** ä»‹é¢æ§åˆ¶ **

    /** Tab åˆ‡æ›åŠŸèƒ½ */
    function openTab(evt, tabName) {
        let i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tab-button");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(tabName).style.display = "block";
        if (evt) {
            evt.currentTarget.className += " active";
        } else {
            document.querySelector(`.tab-button[onclick*="${tabName}"]`).className += " active";
        }
    }

    // åˆå§‹åŒ–ï¼šå•Ÿå‹•å³æ™‚è³‡æ–™åº«ç›£è½
    window.onload = function() {
        // æª¢æŸ¥ Firebase å‡½å¼æ˜¯å¦å·²è¼‰å…¥
        if (window.firebaseUtils) {
             startRealtimeListener();
        } else {
            alert("Firebase å‡½å¼åº«è¼‰å…¥å¤±æ•—ï¼è«‹æª¢æŸ¥æ‚¨çš„ç¶²è·¯é€£ç·šæˆ– Firebase SDK ç¨‹å¼ç¢¼æ˜¯å¦æ­£ç¢ºã€‚");
        }
        openTab(null, 'uploadTab'); 
    };
</script>

</body>
</html>
